USE ISRS
DROP TABLE IF EXISTS #INSTR
SELECT
CONCAT(YRTR, '-', COU_ID) AS RECORD_ID,
CONCAT(V_STARID.FIRST_NAME, ' ', V_STARID.LAST_NAME) AS FACULTY_NAME,
V_HR_EMPL_PERSON_PUBLIC.EMPT_COND_DESC
INTO #INSTR
FROM CT_INSTR
inner JOIN V_STARID
ON CT_INSTR.INSTR_ID = V_STARID.TECH_ID
inner JOIN V_HR_EMPL_PERSON_PUBLIC
ON CT_INSTR.INSTR_ID = V_HR_EMPL_PERSON_PUBLIC.TECH_ID
WHERE YRTR >=20193 

---SELECT * FROM #INSTR

DROP TABLE IF EXISTS #CT_COU
SELECT 
CONCAT(YRTR,'-',COU_ID) RECORD_ID,
CT_COU.YRTR,
CT_COU.COU_ID,
CT_COU.SUBJ,
CT_COU.COU_NBR,
CT_COU.TITLE,
CT_COU.SECT_NBR,
CT_COU.PRMRY_CIP_ID
INTO #CT_COU
FROM CT_COU
WHERE YRTR >=20193 

DROP TABLE IF EXISTS #FIRST_PART
SELECT distinct
#ct_cou.RECORD_ID,
YRTR,
CONCAT(SUBJ, COU_NBR, '-', SECT_NBR,' ', TITLE) AS COURSE_NAME,
FACULTY_NAME,
EMPT_COND_DESC
INTO #FIRST_PART
FROM #CT_COU
inner JOIN #INSTR
ON #CT_COU.RECORD_ID = #INSTR.RECORD_ID

--SELECT * FROM #FIRST_PART
USE ISRS
SELECT 
CONCAT(YRTR,'-',COU_ID) AS RECORD_ID,
COUNT(tech_id) AS count_tech_id
FROM ST_COU
WHERE 
YRTR >=20193 AND DROP_TIME_STAMP IS NULL
GROUP BY YRTR, COU_ID
